<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞</title>

  <style>
    :root{
      --accent:#ff2e6d;
      --bg1:#ffe6f0;
      --bg2:#ffd1e3;
      --text:#2b2b2b;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; min-height:100vh; overflow:hidden;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
      background: radial-gradient(1100px 800px at 30% 20%, var(--bg2), var(--bg1));
      display:flex; align-items:center; justify-content:center;
      padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom);
      color:var(--text);
    }

    .card{
      width:min(420px, 94vw);
      height:min(720px, 92vh);
      border-radius:22px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
      padding:16px 14px;
      isolation:isolate;
    }

    /* floating hearts background */
    .hearts{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:1;
      overflow:hidden;
    }
    .heart{
      position:absolute; bottom:-12%;
      left: var(--x);
      font-size: var(--s);
      opacity:0;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.18));
      animation: floatUp var(--d) linear infinite;
      animation-delay: var(--delay);
      transform: translateZ(0);
      pointer-events:none;
    }
    @keyframes floatUp{
      0%{ transform: translate3d(var(--dx1),0,0) rotate(var(--r)); opacity:0; }
      12%{ opacity:1; }
      100%{ transform: translate3d(var(--dx2),-130vh,0) rotate(calc(var(--r) + 35deg)); opacity:0; }
    }

    h1{
      margin: 10px 0 8px;
      text-align:center;
      color:var(--accent);
      font-size: clamp(28px, 7vw, 44px);
      line-height:1.08;
      letter-spacing:-0.02em;
      position:relative;
      z-index:2;
      pointer-events:none;
    }
    .sub{
      margin:0 0 12px;
      text-align:center;
      font-size:13px;
      opacity:.75;
      position:relative;
      z-index:2;
      pointer-events:none;
    }

    /* play area */
    .playArea{
      position:relative;
      width:100%;
      height: 56%;
      min-height: 320px;
      border-radius:18px;
      background: rgba(255,255,255,.35);
      border: 1px solid rgba(255,46,109,.12);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:5;               /* –≤–∞–∂–Ω–æ: –≤—ã—à–µ —Ñ–æ–Ω–æ–≤—ã—Ö —Å–ª–æ—ë–≤ */
      touch-action: manipulation;
    }

    .btnRow{
      position:relative;
      width:100%;
      max-width: 360px;
      display:flex;
      gap:14px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      z-index:6;
    }

    button{
      border:0;
      border-radius:14px;
      padding:14px 26px;
      font-size: clamp(18px, 5vw, 22px);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
      transition: transform .15s ease;
      position:relative;
      z-index:10;              /* –∫–Ω–æ–ø–∫–∏ —Ç–æ—á–Ω–æ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã */
    }
    #yes{ background:var(--accent); color:#fff; }
    #no { background:#e6e6e6; color:#222; }

    .hint{
      margin-top: 12px;
      text-align:center;
      font-size: 12px;
      opacity:.65;
      position:relative; z-index:2;
      pointer-events:none;
    }

    /* music helper button (fallback) */
    .musicBtn{
      margin-top: 10px;
      width:100%;
      display:flex;
      justify-content:center;
      position:relative;
      z-index:7;
    }
    #playMusic{
      background: rgba(0,0,0,.08);
      color:#222;
      border:1px solid rgba(0,0,0,.12);
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
    }
    #playMusic.hidden{ display:none; }

    /* explosion hearts */
    .boom{
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      font-size:var(--bs);
      opacity:1;
      animation: burst .95s ease-out forwards;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.25));
      pointer-events:none;
      z-index:9; /* –Ω–∞–¥ –≤—Å–µ–º */
    }
    @keyframes burst{
      0%{ transform:translate(-50%,-50%) translate(0,0) scale(.9); opacity:1; }
      100%{ transform:translate(-50%,-50%) translate(var(--bdx),var(--bdy)) scale(1.25); opacity:0; }
    }

    /* FINAL overlay */
    .final{
      position:absolute;
      inset:0;
      z-index:20;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      pointer-events:auto;
    }
    .final.show{ display:flex; }

    .finalBg{
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.62));
    }

    .photoWrap{
      position:relative;
      width:min(360px, 90vw);
      border-radius:22px;
      overflow:hidden;
      box-shadow: 0 24px 70px rgba(0,0,0,.35);
      transform: translateY(26px) scale(.96);
      opacity:0;
      animation: popIn .8s cubic-bezier(.2,1,.2,1) forwards;
      background:#000;
      z-index:21;
    }
    @keyframes popIn{
      to { transform: translateY(0) scale(1); opacity:1; }
    }

    .photo{
      width:100%;
      height:auto;
      display:block;
      transform: scale(1.02);
      animation: slowZoom 10s ease-in-out infinite alternate;
    }
    @keyframes slowZoom{
      from { transform: scale(1.02); }
      to   { transform: scale(1.10); }
    }

    .caption{
      position:absolute;
      left:0; right:0; bottom:0;
      padding:14px 14px 12px;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.72));
      color:#fff;
      text-shadow: 0 10px 30px rgba(0,0,0,.45);
    }
    .cap1{
      font-size: clamp(22px, 6vw, 34px);
      font-weight: 800;
      line-height:1.05;
      margin:0;
    }
    .cap2{
      margin:8px 0 0;
      font-size: 16px;
      opacity:.95;
    }

    /* small devices tweak */
    @media (max-height: 680px){
      .card{ height:min(680px, 92vh); }
      .playArea{ min-height: 300px; }
    }
  </style>
</head>

<body>
  <!-- Audio: —á–µ—Ä–µ–∑ source + type + –∞–Ω—Ç–∏-–∫—ç—à -->
  <audio id="song" preload="auto" playsinline>
    <source src="song.mp3?v=7" type="audio/mpeg">
  </audio>

  <div class="card" id="card">
    <div class="hearts" id="hearts"></div>

    <h1>–¢—ã –±—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?</h1>
    <p class="sub">–í—ã–±–æ—Ä –æ—á–µ–≤–∏–¥–µ–Ω üòåüíû</p>

    <div class="playArea" id="area">
      <div class="btnRow" id="btnRow">
        <button id="yes" type="button">–î–∞</button>
        <button id="no" type="button">–ù–µ—Ç</button>
      </div>
    </div>

    <div class="musicBtn">
      <button id="playMusic" type="button" class="hidden">üîä –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>
    </div>

    <div class="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–Ω–æ–ø–∫–∞ ¬´–ù–µ—Ç¬ª —Å–µ–≥–æ–¥–Ω—è –¥–µ—Ä–∑–∫–∞—è üòà</div>

    <!-- Final -->
    <div class="final" id="final">
      <div class="finalBg"></div>
      <div class="photoWrap">
        <img class="photo" src="photo.jpg" alt="–º—ã" />
        <div class="caption">
          <p class="cap1">–í–∞–ª–µ—Ä–∞, –µ—à—å —è–π—Ü–∞ üíû</p>
          <p class="cap2">–õ—é–±–ª—é —Ç–µ–±—è –∫–æ—Ç–∏–∫ –º–æ–π</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const hearts = document.getElementById("hearts");
    const area   = document.getElementById("area");
    const yes    = document.getElementById("yes");
    const no     = document.getElementById("no");
    const final  = document.getElementById("final");
    const card   = document.getElementById("card");
    const song   = document.getElementById("song");
    const playMusicBtn = document.getElementById("playMusic");

    // Floating hearts
    function makeHeart(layer){
      const h = document.createElement("div");
      h.className = "heart";
      h.textContent = "üíû";
      h.style.setProperty("--x", (Math.random()*100).toFixed(2) + "%");
      h.style.setProperty("--s", (12 + Math.random()*58).toFixed(0) + "px");
      h.style.setProperty("--d", (4 + Math.random()*7).toFixed(2) + "s");
      h.style.setProperty("--delay", (-Math.random()*4).toFixed(2) + "s");
      h.style.setProperty("--dx1", (Math.random()*40 - 20).toFixed(1) + "%");
      h.style.setProperty("--dx2", (Math.random()*60 - 30).toFixed(1) + "%");
      h.style.setProperty("--r", (Math.random()*60 - 30).toFixed(0) + "deg");
      layer.appendChild(h);
      setTimeout(()=>h.remove(), 12000);
    }
    for(let i=0;i<26;i++) setTimeout(()=>makeHeart(hearts), i*120);
    setInterval(()=>makeHeart(hearts), 220);

    // Vibration (Android mostly; iPhone browser usually ignores)
    function multiVibrate(){
      if (navigator.vibrate) navigator.vibrate([80,60,80,60,120,80,120]);
    }

    // Heart explosion
    function explode(count=90){
      const r = card.getBoundingClientRect();
      for(let i=0;i<count;i++){
        const b = document.createElement("div");
        b.className = "boom";
        b.textContent = "üíû";

        const ang = Math.random()*Math.PI*2;
        const dist = 70 + Math.random()*240;

        b.style.left = (r.width/2) + "px";
        b.style.top  = (r.height/2) + "px";
        b.style.setProperty("--bdx", (Math.cos(ang)*dist).toFixed(1) + "px");
        b.style.setProperty("--bdy", (Math.sin(ang)*dist).toFixed(1) + "px");
        b.style.setProperty("--bs", (18 + Math.random()*62).toFixed(0) + "px");

        card.appendChild(b);
        setTimeout(()=>b.remove(), 1100);
      }
    }

    // NO button logic
    const phrases = ["—Ç—ã –ø–æ-–º–æ–µ–º—É –ø–µ—Ä–µ–ø—É—Ç–∞–ª", "–∞—Ö —Ç—ã –∂—É—É–∫", "–¥–∞ —Ç—ã —Å–Ω–∞–π–ø–µ—Ä!"];
    let p = 0;

    function moveNo(e){
      if(e) e.preventDefault();

      const r = area.getBoundingClientRect();
      const bw = no.offsetWidth || 100;
      const bh = no.offsetHeight || 52;
      const pad = 12;

      const maxX = Math.max(pad, r.width - bw - pad);
      const maxY = Math.max(pad, r.height - bh - pad);

      const x = pad + Math.random() * (maxX - pad);
      const y = pad + Math.random() * (maxY - pad);

      no.style.position = "absolute";
      no.style.left = x + "px";
      no.style.top  = y + "px";

      no.textContent = phrases[p % phrases.length];
      p++;

      // YES grows
      yes.style.transform = "scale(" + (1 + Math.min(p*0.14, 1.6)) + ")";
    }

    no.addEventListener("mouseenter", moveNo);
    no.addEventListener("click", moveNo);
    no.addEventListener("touchstart", moveNo, {passive:false});

    // Robust audio start
    async function startMusic(){
      try{
        song.pause();
        song.currentTime = 0;
        song.muted = false;
        song.volume = 1.0;
        const pr = song.play();
        if (pr && typeof pr.then === "function") await pr;
        playMusicBtn.classList.add("hidden");
        return true;
      }catch(e){
        // iOS may still block if gesture not recognized; show fallback button
        playMusicBtn.classList.remove("hidden");
        return false;
      }
    }

    playMusicBtn.addEventListener("click", ()=> startMusic());

    yes.addEventListener("click", async ()=>{
      // 1) music on click
      await startMusic();

      // 2) effects
      multiVibrate();
      explode(110);

      // 3) final
      setTimeout(()=>{
        final.classList.add("show");
      }, 650);
    });
  </script>
</body>
</html>
