<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞</title>
  <style>
    :root{
      --accent:#ff2e6d;
      --bg1:#ffe6f0;
      --bg2:#ffd1e3;
      --text:#2b2b2b;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; min-height:100vh; overflow:hidden;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
      background: radial-gradient(1100px 800px at 30% 20%, var(--bg2), var(--bg1));
      display:flex; align-items:center; justify-content:center;
      padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom);
      color:var(--text);
    }

    .card{
      width:min(420px, 94vw);
      height:min(720px, 92vh);
      border-radius:22px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
      padding:16px 14px;

      /* –≤–∞–∂–Ω–æ–µ –¥–ª—è iOS —Å–ª–æ—ë–≤ */
      isolation:isolate;
      transform: translateZ(0);
    }

    /* floating hearts */
    .hearts{ position:absolute; inset:0; pointer-events:none; z-index:1; overflow:hidden; }
    .heart{
      position:absolute; bottom:-12%;
      left: var(--x);
      font-size: var(--s);
      opacity:0;
      /* –Ω–∞ –º–æ–±–∏–ª–µ —Ñ–∏–ª—å—Ç—Ä—ã –º–æ–≥—É—Ç –ª–∞–≥–∞—Ç—å ‚Äî –ª—É—á—à–µ –º—è–≥—á–µ */
      filter: none;
      animation: floatUp var(--d) linear infinite;
      animation-delay: var(--delay);
      transform: translateZ(0);
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0%{ transform: translate3d(var(--dx1),0,0) rotate(var(--r)); opacity:0; }
      12%{ opacity:1; }
      100%{ transform: translate3d(var(--dx2),-130vh,0) rotate(calc(var(--r) + 35deg)); opacity:0; }
    }

    h1{
      margin: 10px 0 8px;
      text-align:center;
      color:var(--accent);
      font-size: clamp(28px, 7vw, 44px);
      line-height:1.08;
      letter-spacing:-0.02em;
      position:relative; z-index:2;
    }
    .sub{
      margin:0 0 12px;
      text-align:center;
      font-size:13px;
      opacity:.75;
      position:relative; z-index:2;
    }

    /* play area */
    .playArea{
      position:relative;
      width:100%;
      height: 56%;
      min-height: 320px;
      border-radius:18px;
      background: rgba(255,255,255,.35);
      border: 1px solid rgba(255,46,109,.12);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:2;
      touch-action: manipulation;
    }
    .btnRow{
      position:relative;
      width:100%;
      max-width: 360px;
      display:flex;
      gap:14px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
    }
    button{
      border:0;
      border-radius:14px;
      padding:14px 26px;
      font-size: clamp(18px, 5vw, 22px);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
      transition: transform .15s ease;
      touch-action: manipulation;
    }
    #yes{ background:var(--accent); color:#fff; }
    #no { background:#e6e6e6; color:#222; }

    /* –°–õ–û–ô –≠–§–§–ï–ö–¢–û–í –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
    #fx{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:9999;
    }
    /* canvas –¥–ª—è –≤–∑—Ä—ã–≤–∞ */
    #burstCanvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
    }

    /* FINAL overlay */
    .final{
      position:absolute;
      inset:0;
      z-index:10;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .final.show{ display:flex; }

    .finalBg{
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.62));
    }

    .photoWrap{
      position:relative;
      width:min(360px, 90vw);
      margin-top: 60px;
      border-radius:22px;
      overflow:hidden;
      box-shadow: 0 24px 70px rgba(0,0,0,.35);
      transform: translateY(26px) scale(.96);
      opacity:0;
      animation: popIn .8s cubic-bezier(.2,1,.2,1) forwards;
      background:#000;
      z-index:11;
    }
    @keyframes popIn{ to { transform: translateY(0) scale(1); opacity:1; } }

    .photo{
      width:100%;
      height:auto;
      display:block;
      transform: scale(1.02);
      animation: slowZoom 10s ease-in-out infinite alternate;
    }
    @keyframes slowZoom{ from { transform: scale(1.02); } to { transform: scale(1.10); } }

    .caption{
      position:absolute;
      left:0; right:0; bottom:0;
      padding:14px 14px 12px;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.72));
      color:#fff;
      text-shadow: 0 10px 30px rgba(0,0,0,.45);
    }
    .cap1{
      font-size: clamp(22px, 6vw, 34px);
      font-weight: 800;
      line-height:1.05;
      margin:0;
    }
    .cap2{
      margin:8px 0 0;
      font-size: 16px;
      opacity:.95;
    }

    .hint{
      margin-top: 12px;
      text-align:center;
      font-size: 12px;
      opacity:.65;
      position:relative; z-index:2;
    }
  </style>
</head>
<body>
  <div class="card" id="card">
    <div class="hearts" id="hearts"></div>

    <div id="fx">
      <canvas id="burstCanvas"></canvas>
    </div>

    <h1>–¢—ã –±—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?</h1>
    <p class="sub">–í—ã–±–æ—Ä –æ—á–µ–≤–∏–¥–µ–Ω üòåüíû</p>

    <div class="playArea" id="area">
      <div class="btnRow" id="btnRow">
        <button id="yes" type="button">–î–∞</button>
        <button id="no" type="button">–ù–µ—Ç</button>
      </div>
    </div>

    <div class="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–Ω–æ–ø–∫–∞ ¬´–ù–µ—Ç¬ª —Å–µ–≥–æ–¥–Ω—è –∂–æ—Å–∫–∏—á üòà</div>

    <div class="final" id="final">
      <div class="finalBg"></div>
      <div class="photoWrap">
        <img class="photo" src="photo.jpg" alt="–º—ã" />
        <div class="caption">
          <p class="cap1">–í–∞–ª–µ—Ä–∞, –µ—à—å —è–π—Ü–∞ üíû</p>
          <p class="cap2">–õ—é–±–ª—é —Ç–µ–±—è –∫–æ—Ç–∏–∫ –º–æ–π</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const hearts = document.getElementById("hearts");
    const area   = document.getElementById("area");
    const card   = document.getElementById("card");
    const yes    = document.getElementById("yes");
    const no     = document.getElementById("no");
    const final  = document.getElementById("final");

    const canvas = document.getElementById("burstCanvas");
    const ctx = canvas.getContext("2d");

    // --- helpers
    function isMobile(){
      return matchMedia("(hover: none)").matches;
    }
    const reduceMotion = matchMedia("(prefers-reduced-motion: reduce)").matches;

    // –í–∏–±—Ä–∞—Ü–∏—è (Android; iPhone –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –∏–≥–Ω–æ—Ä–∏—Ç)
    function multiVibrate(){
      if (navigator.vibrate) navigator.vibrate([60,40,80,40,120]);
    }

    // --- Floating hearts (—Ñ–æ–Ω)
    let floatInterval = null;
    function makeHeart(layer){
      const h = document.createElement("div");
      h.className = "heart";
      h.textContent = "üíû";
      h.style.setProperty("--x", (Math.random()*100).toFixed(2) + "%");
      h.style.setProperty("--s", (12 + Math.random()*50).toFixed(0) + "px");
      h.style.setProperty("--d", (5 + Math.random()*7).toFixed(2) + "s");
      h.style.setProperty("--delay", (-Math.random()*4).toFixed(2) + "s");
      h.style.setProperty("--dx1", (Math.random()*40 - 20).toFixed(1) + "%");
      h.style.setProperty("--dx2", (Math.random()*60 - 30).toFixed(1) + "%");
      h.style.setProperty("--r", (Math.random()*60 - 30).toFixed(0) + "deg");
      layer.appendChild(h);
      setTimeout(()=>h.remove(), 13000);
    }

    for(let i=0;i<18;i++) setTimeout(()=>makeHeart(hearts), i*140);
    floatInterval = setInterval(()=>makeHeart(hearts), 260);

    function stopFloatingHearts(){
      if(floatInterval){
        clearInterval(floatInterval);
        floatInterval = null;
      }
      // –ª—ë–≥–∫–∞—è —á–∏—Å—Ç–∫–∞, —á—Ç–æ–±—ã –Ω–µ –≥—Ä—É–∑–∏—Ç—å —Ñ–∏–Ω–∞–ª
      setTimeout(()=>{ hearts.innerHTML = ""; }, 900);
    }

    // --- CANVAS explosion (–±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ –ª–∞–≥–æ–≤ –Ω–∞ iPhone)
    let particles = [];
    let animId = 0;

    function resizeCanvasToCard(){
      const r = card.getBoundingClientRect();
      const dpr = Math.min(2, window.devicePixelRatio || 1); // –Ω–µ –±–æ–ª—å—à–µ 2, —á—Ç–æ–±—ã –Ω–µ —É–±–∏—Ç—å iPhone
      canvas.width  = Math.floor(r.width * dpr);
      canvas.height = Math.floor(r.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function explodeCanvas(){
      if(reduceMotion) return;

      resizeCanvasToCard();
      const r = card.getBoundingClientRect();
      const cx = r.width / 2;
      const cy = r.height / 2;

      const count = isMobile() ? 26 : 70;   // –∫–ª—é—á: –º–µ–Ω—å—à–µ —á–∞—Å—Ç–∏—Ü –Ω–∞ –º–æ–±–∏–ª–µ
      const maxDist = isMobile() ? 220 : 340;

      particles = [];
      for(let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const sp = (isMobile()? 2.4 : 3.2) + Math.random()*1.8;
        particles.push({
          x: cx, y: cy,
          vx: Math.cos(a)*sp,
          vy: Math.sin(a)*sp - (isMobile()? 1.2 : 1.6),
          g: 0.06 + Math.random()*0.04,
          life: 1.0,
          size: (isMobile()? 18 : 22) + Math.random()*(isMobile()? 18 : 38),
          rot: (Math.random()*0.6 - 0.3),
          drift: (Math.random()*0.4 - 0.2),
          max: maxDist
        });
      }

      cancelAnimationFrame(animId);
      const start = performance.now();

      function tick(t){
        const dt = Math.min(32, t - start);
        ctx.clearRect(0,0, r.width, r.height);

        // —Ä–∏—Å—É–µ–º
        for(let i=particles.length-1; i>=0; i--){
          const p = particles[i];
          p.vy += p.g;
          p.x += p.vx + p.drift;
          p.y += p.vy;
          p.life -= 0.018;

          const dx = p.x - cx, dy = p.y - cy;
          if(p.life <= 0 || (dx*dx + dy*dy) > (p.max*p.max)){
            particles.splice(i,1);
            continue;
          }

          ctx.globalAlpha = Math.max(0, p.life);
          ctx.font = `${p.size}px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif`;
          ctx.fillText("üíû", p.x, p.y);
        }

        ctx.globalAlpha = 1;

        if(particles.length){
          animId = requestAnimationFrame(tick);
        } else {
          ctx.clearRect(0,0, r.width, r.height);
        }
      }

      animId = requestAnimationFrame(tick);
    }

    // --- NO button logic
    const phrases = ["—Ç—ã –ø–æ-–º–æ–µ–º—É –ø–µ—Ä–µ–ø—É—Ç–∞–ª", "–∞—Ö —Ç—ã –∂—É—É–∫", "–¥–∞ —Ç—ã —Å–Ω–∞–π–ø–µ—Ä!"];
    let p = 0;

    function moveNo(e){
      if(e) e.preventDefault();

      const r = area.getBoundingClientRect();
      const bw = no.offsetWidth || 90;
      const bh = no.offsetHeight || 54;
      const pad = 12;

      const maxX = Math.max(pad, r.width - bw - pad);
      const maxY = Math.max(pad, r.height - bh - pad);

      const x = pad + Math.random() * (maxX - pad);
      const y = pad + Math.random() * (maxY - pad);

      no.style.position = "absolute";
      no.style.left = x + "px";
      no.style.top  = y + "px";

      no.textContent = phrases[p % phrases.length];
      p++;

      yes.style.transform = "scale(" + (1 + Math.min(p*0.14, 1.6)) + ")";
    }

    no.addEventListener("mouseenter", moveNo);
    no.addEventListener("click", moveNo);
    no.addEventListener("touchstart", moveNo, {passive:false});

    // YES
    let fired = false;
    function onYes(e){
      if(e) e.preventDefault();
      if(fired) return;
      fired = true;

      // —É–º–µ–Ω—å—à–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É —Å—Ä–∞–∑—É
      stopFloatingHearts();

      requestAnimationFrame(()=>{
        multiVibrate();
        explodeCanvas();

        setTimeout(()=>{
          final.classList.add("show");
        }, isMobile() ? 700 : 850);
      });
    }

    yes.addEventListener("touchend", onYes, {passive:false});
    yes.addEventListener("click", onYes);

    // –Ω–∞ —Ä–µ—Å–∞–π–∑/–ø–æ–≤–æ—Ä–æ—Ç ‚Äî –ø–æ–¥–≥–æ–Ω—è–µ–º canvas
    window.addEventListener("resize", ()=> {
      if(particles.length) resizeCanvasToCard();
    });
  </script>
</body>
</html>
